{% extends 'base.html' %}
{% block content %}
<div class="container">
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px;">
        {% for post in posts %}
        <div class="post-card"
            style="background: white; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; position: relative;">

            <div style="padding: 12px 15px; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    {% if post.author.avatar %}
                    <img src="{{ post.author.avatar.url }}"
                        style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;">
                    {% else %}
                    <div
                        style="width: 35px; height: 35px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center;">
                        <i class="fa-solid fa-user" style="font-size: 0.8rem; color: white;"></i>
                    </div>
                    {% endif %}
                    <span style="font-weight: 600; font-size: 0.9rem;">{{ post.author.username }}</span>
                </div>
                <small style="color: var(--gray); font-size: 0.75rem;">
                    <i class="fa-regular fa-clock"></i> {{ post.created_at|date:"H:i" }} |
                    {{post.created_at|date:"d.m.Y" }}
                </small>
            </div>

            <a href="{% url 'post_detail' post.id %}" style="display: block; text-decoration: none;">
                <img src="{{ post.image.url }}" style="width: 100%; height: 280px; object-fit: cover;">
                <div style="padding: 15px;">
                    <span
                        style="background: #edf2ff; color: #4c6ef5; padding: 3px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700;">
                        {{ post.category.name }}
                    </span>
                    <h2 style="margin: 12px 0 8px 0; font-size: 1.25rem; color: var(--text);">{{ post.title }}</h2>
                    <p
                        style="color: #4a4a4a; font-size: 0.95rem; line-height: 1.5; margin-bottom: 15px; word-wrap: break-word;">
                        {{ post.short_description }}
                    </p>
                </div>
            </a>

            <div style="padding: 0 15px 15px 15px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 15px; align-items: center;">
                    <form
                        action="{% if user.is_authenticated %}{% url 'post_like' post.id %}{% else %}{% url 'login' %}{% endif %}"
                        method="POST">
                        {% csrf_token %}
                        <button type="submit"
                            style="background: none; border: 1px solid #eee; padding: 5px 15px; border-radius: 20px; cursor: pointer;">
                            {% if user in post.likes.all %} ‚ù§Ô∏è {% else %} ü§ç {% endif %}
                            {{ post.likes.count }}
                        </button>
                    </form> <span style="color: var(--gray); font-size: 0.9rem;">
                        <i class="fa-regular fa-eye"></i> {{ post.view_count }}
                    </span>
                </div>
            </div>
        </div>
        {% empty %}
        <div style="grid-column: 1/-1; text-align: center; padding: 50px;">
            <p style="color: var(--gray);">Hozircha hech qanday post yo'q.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}